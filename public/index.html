<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>helium | HNT | cy</title>

  <!-- Raw power -->
  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"
    integrity="sha256-qXBd/EfAdjOA2FGrGAG+b3YBn2tn5A6bhz+LSgYD96k=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <!-- Leaflet required -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin=""></script>
  <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js'></script>
  <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css'
    rel='stylesheet' />

  <!-- Map and hotspot related -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/randomcolor/0.6.1/randomColor.min.js"
    integrity="sha512-vPeZ7JCboHcfpqSx5ZD+/jpEhS4JpXxfz9orSvAPPj0EKUVShU2tgy7XkU+oujBJKnWmu4hU7r9MMQNWPfXsYw=="
    crossorigin="anonymous"></script>

  <!-- update the version number as needed -->
  <script defer src="/__/firebase/8.4.3/firebase-app.js"></script>
  <!-- include only the Firebase features as you need -->
  <script defer src="/__/firebase/8.4.3/firebase-auth.js"></script>
  <script defer src="/__/firebase/8.4.3/firebase-database.js"></script>
  <!-- <script defer src="/__/firebase/8.4.3/firebase-firestore.js"></script> -->
  <!-- <script defer src="/__/firebase/8.4.3/firebase-functions.js"></script> -->
  <!-- <script defer src="/__/firebase/8.4.3/firebase-messaging.js"></script> -->
  <!-- <script defer src="/__/firebase/8.4.3/firebase-storage.js"></script> -->
  <script defer src="/__/firebase/8.4.3/firebase-analytics.js"></script>
  <!-- <script defer src="/__/firebase/8.4.3/firebase-remote-config.js"></script> -->
  <!-- <script defer src="/__/firebase/8.4.3/firebase-performance.js"></script> -->
  <!-- 
      initialize the SDK after all desired features are loaded, set useEmulator to false
      to avoid connecting the SDK to running emulators.
    -->
  <script defer src="/__/firebase/init.js?useEmulator=true"></script>

  <style media="screen">
    html,
    body {
      height: 100%;
    }

    body {
      background: #ECEFF1;
      color: rgba(0, 0, 0, 0.87);
      font-family: Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    #load {
      color: rgba(0, 0, 0, 0.4);
      text-align: center;
      font-size: 13px;
    }

    #mapid {
      height: 100%;
    }

    @media (max-width: 600px) {
      body {
        border-top: 16px solid #ffa100;
      }
    }
  </style>
</head>

<body>
  <div id="mapid"></div>
  <p id="load">Firebase SDK Loading&hellip;</p>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const loadEl = document.querySelector('#load');
      // // ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥
      // // The Firebase SDK is initialized and available here!
      //
      // firebase.auth().onAuthStateChanged(user => { });
      // firebase.database().ref('/path/to/ref').on('value', snapshot => { });
      // firebase.firestore().doc('/foo/bar').get().then(() => { });
      // firebase.functions().httpsCallable('yourFunction')().then(() => { });
      // firebase.messaging().requestPermission().then(() => { });
      // firebase.storage().ref('/path/to/ref').getDownloadURL().then(() => { });
      // firebase.analytics(); // call to activate
      // firebase.analytics().logEvent('tutorial_completed');
      // firebase.performance(); // call to activate
      //
      // // ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥ðŸ”¥

      var db = firebase.database();
      if (location.hostname === "localhost") {
        // Point to the RTDB emulator running on localhost.
        db.useEmulator("localhost", 9000);
      }

      try {
        let app = firebase.app();
        let features = [
          'auth',
          'database',
          'firestore',
          'functions',
          'messaging',
          'storage',
          'analytics',
          'remoteConfig',
          'performance',
        ].filter(feature => typeof app[feature] === 'function');
        loadEl.textContent = `Firebase SDK loaded with ${features.join(', ')}`;
      } catch (e) {
        console.error(e);
        loadEl.textContent = 'Error loading the Firebase SDK, check the console.';
      }

      // Leaflet
      var mymap = L.map('mapid', {
        fullscreenControl: {
          pseudoFullscreen: false
        }
      }).setView([35.1, 33.4], 9);
      L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/dark-v10/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoiZXJpYy1oZWxpdW0iLCJhIjoiY2tvNnp4ZnhuMXI2MjJvczVhODFiNG9wZCJ9.lbv1OPPLn1gUY9Lk1owA0Q', {
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
        maxZoom: 18,
        id: 'mapbox/dark-v10',
        tileSize: 512,
        zoomOffset: -1,
        accessToken: 'pk.eyJ1IjoiZXJpYy1oZWxpdW0iLCJhIjoiY2tvNnp4ZnhuMXI2MjJvczVhODFiNG9wZCJ9.lbv1OPPLn1gUY9Lk1owA0Q'
      }).addTo(mymap);

      axios.get('https://api.helium.io/v1/hotspots/location/box?swlat=34.357042&swlon=31.854858&nelat=35.811131&nelon=34.925537')
        .then(function (response) {
          if (response && response.data && response.data.data) {
            var data = response.data.data;
            _.each(data, function (x) {
              var c = randomColor({
                seed: x.owner,
                luminosity: 'dark',
                format: 'rgba',
                alpha: 0.5
              });
              var circleLarge = L.circle([x.lat, x.lng], {
                stroke: false,
                fillColor: c,
                fillOpacity: 0.1,
                radius: 2800,
                interactive: false
              }).addTo(mymap);
              var circleSmall = L.circle([x.lat, x.lng], {
                color: c,
                fillColor: c,
                fillOpacity: 0.5,
                radius: 300
              }).addTo(mymap);
              circleSmall.bindTooltip(x.name);
            });
          }
        })
        .catch(function (error) {
          console.log(error);

        })
        .then(function () {

        });

      var spotsRef = db.ref('spots');
      spotsRef.on('value', (snapshot) => {
        var spots = snapshot.val();
        _.each(spots, function (x) {
          var c = randomColor({
            seed: x.name,
            luminosity: 'light',
            format: 'rgba',
            alpha: 0.5
          });
          var circleSmall = L.circle([x.lat, x.lng], {
            stroke: false,
            fillColor: c,
            fillOpacity: 0.5,
            radius: 300
          }).addTo(mymap);
          circleSmall.bindTooltip(x.name);
        });
      });
    });
  </script>
</body>

</html>